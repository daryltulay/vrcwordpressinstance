/* ------------------------------------------------------------------------
	* LCweb text shortener
	*
	* @version: 	1.0
	* @requires:	jQuery v1.5 or later
	* @author:		Luca Montanari (LCweb) (http://projects.lcweb.it)
	
	* Licensed under the MIT license
------------------------------------------------------------------------- */

(function(b){b.fn.lcweb_txt_shortener=function(g,e,q,r){var p=b(this);"undefined"==typeof lcts_orig_texts&&(lcts_orig_texts=b.makeArray());"undefined"==typeof g&&(g="..");var n=function(){p.each(function(){var a=b(this),c=b(this).attr("lcts-id");"undefined"==typeof c?(c=Math.round((new Date).getTime()+100*Math.random()),b(this).attr("lcts-id",c),lcts_orig_texts[c]=a.html()):(a.html(lcts_orig_texts[c]),a.removeClass("lcnb_shorten"));a.find("*:empty").not("br, img").remove();var c=a.outerHeight(!0), d="undefined"!=typeof e&&e?parseInt(e):a.parent().height();"undefined"!=typeof e&&parseInt(e)>d&&(d=parseInt(e));if(d<c){a.html();a.addClass("lcnb_shorten");a.find("*").lcts_remove_all_attr();a.find("*").not("a, p, br").each(function(){var a=b(this).contents();b(this).replaceWith(a)});for(var f=a.html().split(" "),k="",h="",l=c=0;c<d&&l<f.length;)if("undefined"!=typeof f[l]){h=k;k=k+f[l]+" ";for(a.html(k+' <span class="lcts_end_txt">'+g+"</span>");-1!=a.html().indexOf('<br> <span class="lcts_end_txt">');)a.find(".lcts_end_txt").prev().remove(); c=a.outerHeight(!0);l++}var m=["a","p"];b.each(m,function(c,b){var d=h.match("<"+b,"g"),f=h.match("</"+b,"g");null!=d&&(null!=d&&null==f||d.length>f.length)&&(h=h+"</"+b+">");if(c==m.length-1)for(a.html(h+'<span class="lcts_end_txt">'+g+"</span>"),a.find("*:empty").not("br").remove();-1!=a.html().indexOf('<br> <span class="lcts_end_txt">');)a.find(".lcts_end_txt").prev().remove()});a.find("p").last().css("display","inline")}})};b.fn.lcts_remove_all_attr=function(){return this.each(function(){var a= b.map(this.attributes,function(a){return a.name}),c=b(this);b.each(a,function(a,b){"href"!=b&&"target"!=b&&c.removeAttr(b)})})};(function(a,b,d,f){var e=function(a,b,c){var d;return function(){var e=this,g=arguments;d?clearTimeout(d):c&&a.apply(e,g);d=setTimeout(function(){c||a.apply(e,g);d=null},b||f)}};jQuery.fn[b]=function(a){return a?this.bind(d,e(a)):this.trigger(b)}})(jQuery,"lcts_smartresize","resize",50);b(window).lcts_smartresize(function(a,b,d,e){n()});return n()}})(jQuery);